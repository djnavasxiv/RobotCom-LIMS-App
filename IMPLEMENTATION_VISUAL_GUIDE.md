# Visual Implementation Overview

**A comprehensive map of all components, services, and data flows**

---

## SYSTEM ARCHITECTURE DIAGRAM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ELECTRON DESKTOP APP                         â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    REACT FRONTEND LAYER                      â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ Test Forms  â”‚  â”‚   Invoice    â”‚  â”‚  Email Management   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ (10 types)  â”‚  â”‚    Entry     â”‚  â”‚      UI (6 comp)    â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚         â”‚                 â”‚                      â”‚            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚          IPC Communication (Electron Bridge)           â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - Calculation requests                               â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - Email sending triggers                             â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - Data validation                                    â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                    â”‚
        â”‚    MAIN PROCESS (Node.js)          â”‚
        â”‚                                    â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚    IPC Event Handlers        â”‚  â”‚
        â”‚  â”‚  - payment:recorded          â”‚  â”‚
        â”‚  â”‚  - result:submitted          â”‚  â”‚
        â”‚  â”‚  - email:send                â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                 â”‚                  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚   SERVICE LAYER (8 Services) â”‚  â”‚
        â”‚  â”‚                              â”‚  â”‚
        â”‚  â”‚  âœ“ CalculationEngine         â”‚  â”‚
        â”‚  â”‚  âœ“ ResultInterpreter         â”‚  â”‚
        â”‚  â”‚  âœ“ DeltaCheckEngine          â”‚  â”‚
        â”‚  â”‚  âœ“ ReflexTestingEngine       â”‚  â”‚
        â”‚  â”‚  âœ“ EmailService (NEW)        â”‚  â”‚
        â”‚  â”‚  âœ“ PaymentService            â”‚  â”‚
        â”‚  â”‚  âœ“ QualityControlEngine      â”‚  â”‚
        â”‚  â”‚  âœ“ BulkDataService           â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                 â”‚                  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚   PRISMA ORM + SQLite        â”‚  â”‚
        â”‚  â”‚   Data Persistence Layer     â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                 â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                    â”‚
                â”‚   DATABASES        â”‚
                â”‚                    â”‚
                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                â”‚  â”‚  SQLite DB   â”‚  â”‚
                â”‚  â”‚              â”‚  â”‚
                â”‚  â”‚  Tables:     â”‚  â”‚
                â”‚  â”‚  - Patients  â”‚  â”‚
                â”‚  â”‚  - Tests     â”‚  â”‚
                â”‚  â”‚  - Results   â”‚  â”‚
                â”‚  â”‚  - Invoices  â”‚  â”‚
                â”‚  â”‚  - Emails    â”‚  â”‚
                â”‚  â”‚  - Calcs     â”‚  â”‚
                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                â”‚                    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   EXTERNAL SERVICES     â”‚
                â”‚                         â”‚
                â”‚  ğŸ“§ Gmail SMTP          â”‚
                â”‚  (Email sending)        â”‚
                â”‚                         â”‚
                â”‚  ğŸ”œ El Salvador API     â”‚
                â”‚  (Payment - Future)     â”‚
                â”‚                         â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## DATA FLOW: TEST RESULT ENTRY & CALCULATION

```
User Action:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Technician opens test form      â”‚
â”‚ (e.g., Hematology Form)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Form displays:                  â”‚
â”‚ - Hemoglobin: [ _ ] g/dL        â”‚
â”‚ - Hematocrit: [ _ ] %           â”‚
â”‚ - RBC Count:  [ _ ] million/ÂµL  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Technician types values:        â”‚
â”‚ - Hemoglobin: 14.5              â”‚
â”‚ - Hematocrit: 43                â”‚
â”‚ - RBC Count:  4.8               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
        [Form Submission]
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Frontend Validation â”‚
    â”‚ (data type, range)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ IPC Message to Main Process:        â”‚
    â”‚ "result:submit" {                   â”‚
    â”‚   testId: "hemato-123",             â”‚
    â”‚   values: {                         â”‚
    â”‚     hemoglobin: 14.5,               â”‚
    â”‚     hematocrit: 43,                 â”‚
    â”‚     rbc: 4.8                        â”‚
    â”‚   }                                 â”‚
    â”‚ }                                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ CalculationEngine.               â”‚
    â”‚ calculateHematologyIndices()     â”‚
    â”‚                                 â”‚
    â”‚ MCV = (43 Ã— 10) / 4.8 = 89.6    â”‚
    â”‚ MCH = (14.5 Ã— 10) / 4.8 = 30.2  â”‚
    â”‚ MCHC = (14.5 / 43) Ã— 100 = 33.7 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ResultInterpreter.               â”‚
    â”‚ getApplicableNormalRanges()      â”‚
    â”‚                                 â”‚
    â”‚ Patient: Male, 45 years old     â”‚
    â”‚ - Hemoglobin: 13.5-17.5 g/dL    â”‚
    â”‚ - MCV: 80-100 fL                â”‚
    â”‚ - MCH: 27-33 pg                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ResultInterpreter.               â”‚
    â”‚ flagAbnormalities()              â”‚
    â”‚                                 â”‚
    â”‚ 14.5 g/dL is NORMAL             â”‚
    â”‚ 89.6 fL is NORMAL               â”‚
    â”‚ 30.2 pg is NORMAL               â”‚
    â”‚                                 â”‚
    â”‚ isAbnormal: false               â”‚
    â”‚ isCritical: false               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ DeltaCheckEngine.                      â”‚
    â”‚ compareWithPreviousResult()             â”‚
    â”‚                                        â”‚
    â”‚ Previous: Hemoglobin 14.2 (1 year ago) â”‚
    â”‚ Current:  Hemoglobin 14.5              â”‚
    â”‚ Delta:    0.3 (2.1% increase)          â”‚
    â”‚ Status:   NORMAL VARIATION             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ReflexTestingEngine.              â”‚
    â”‚ checkReflexRules()                â”‚
    â”‚                                  â”‚
    â”‚ No reflex tests triggered        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Create TestResult Record:       â”‚
    â”‚ {                               â”‚
    â”‚   testDefinitionId: "hemato",   â”‚
    â”‚   values: {...},                â”‚
    â”‚   calculatedValues: {           â”‚
    â”‚     mcv: 89.6,                  â”‚
    â”‚     mch: 30.2,                  â”‚
    â”‚     mchc: 33.7                  â”‚
    â”‚   },                            â”‚
    â”‚   isAbnormal: false,            â”‚
    â”‚   isCritical: false,            â”‚
    â”‚   deltaValue: 0.3,              â”‚
    â”‚   deltaPercentage: 2.1          â”‚
    â”‚ }                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Save to Database (SQLite)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Return to Frontend:              â”‚
    â”‚ IPC Message "result:submitted" { â”‚
    â”‚   success: true,                 â”‚
    â”‚   resultId: "res-xyz",           â”‚
    â”‚   display: {                     â”‚
    â”‚     hemoglobin: "14.5 âœ“",        â”‚
    â”‚     hematocrit: "43% âœ“",         â”‚
    â”‚     rbc: "4.8 âœ“",                â”‚
    â”‚     mcv: "89.6 fL âœ“",            â”‚
    â”‚     mch: "30.2 pg âœ“",            â”‚
    â”‚     mchc: "33.7% âœ“"              â”‚
    â”‚   }                              â”‚
    â”‚ }                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Frontend Updates UI:         â”‚
    â”‚ - Display all calculated     â”‚
    â”‚   values with green âœ“ mark   â”‚
    â”‚ - Show "Results Submitted"   â”‚
    â”‚ - Show "Ready for Review"    â”‚
    â”‚ - Offer "Send to Patient"    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## DATA FLOW: PAYMENT â†’ EMAIL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Invoice Entry Screen             â”‚
â”‚ Patient: John Doe                â”‚
â”‚ Amount: $150.00                  â”‚
â”‚ Tests: Hematology + Chemistry    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Technician Clicks:               â”‚
â”‚ "Record Payment"                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PaymentEntry Component opens:         â”‚
â”‚ - Amount paid: $150.00                â”‚
â”‚ - Payment method: Cash / Card / Bank  â”‚
â”‚ - Payment date: [auto-filled today]   â”‚
â”‚ [Save Payment] button                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
     [User Clicks Save]
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IPC Message to Main Process:         â”‚
â”‚ "payment:recorded" {                 â”‚
â”‚   invoiceId: "inv-123",              â”‚
â”‚   amount: 150.00,                    â”‚
â”‚   method: "cash",                    â”‚
â”‚   recordedBy: "tech1",               â”‚
â”‚   timestamp: "2025-11-19T14:30:00"   â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PaymentService.recordPayment()       â”‚
â”‚                                      â”‚
â”‚ 1. Find Invoice by ID                â”‚
â”‚ 2. Update invoice.status = "PAID"    â”‚
â”‚ 3. Set invoice.paidAt = now()        â”‚
â”‚ 4. Save to database                  â”‚
â”‚ 5. Emit event: "invoice:paid"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EmailService Listens for "invoice:paid" â”‚
â”‚                                         â”‚
â”‚ 1. Check EmailSetting.                  â”‚
â”‚    enablePaymentConfirmation = true?    â”‚
â”‚ 2. Load EmailTemplate with code:        â”‚
â”‚    "EMAIL_PAYMENT_CONFIRMATION"         â”‚
â”‚ 3. Get template from database:          â”‚
â”‚    {                                    â”‚
â”‚      htmlTemplate: "...",               â”‚
â”‚      subject: "Payment Confirmation",   â”‚
â”‚      variables: ["patientName",         â”‚
â”‚                  "invoiceNumber",       â”‚
â”‚                  "totalAmount", ...]    â”‚
â”‚    }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EmailService.generatePaymentEmail()          â”‚
â”‚                                              â”‚
â”‚ 1. Extract variables:                        â”‚
â”‚    - patientName = "John Doe"                â”‚
â”‚    - invoiceNumber = "INV-2025-001234"       â”‚
â”‚    - totalAmount = "$150.00"                 â”‚
â”‚    - paymentDate = "November 19, 2025"       â”‚
â”‚    - paymentMethod = "Cash"                  â”‚
â”‚                                              â”‚
â”‚ 2. Compile template HTML:                    â”‚
â”‚    Replace {{patientName}} with "John Doe"  â”‚
â”‚    Replace {{invoiceNumber}} with "INV..."  â”‚
â”‚    Replace {{totalAmount}} with "$150.00"   â”‚
â”‚                                              â”‚
â”‚ 3. Generate receipt PDF                      â”‚
â”‚    - Using ReportService.generatePDF()       â”‚
â”‚    - Include invoice details                 â”‚
â”‚    - Add lab logo/branding                   â”‚
â”‚    - Save to temp file                       â”‚
â”‚                                              â”‚
â”‚ 4. Result:                                   â”‚
â”‚    {                                         â”‚
â”‚      to: "john@example.com",                 â”‚
â”‚      subject: "Payment Confirmation",        â”‚
â”‚      htmlContent: "<html>...",               â”‚
â”‚      attachments: [{                         â”‚
â”‚        filename: "receipt.pdf",              â”‚
â”‚        path: "/tmp/receipt-123.pdf"          â”‚
â”‚      }]                                      â”‚
â”‚    }                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EmailService.sendEmail()                    â”‚
â”‚                                             â”‚
â”‚ 1. Get SMTP config from EmailSetting        â”‚
â”‚    - Host: smtp.gmail.com                   â”‚
â”‚    - Port: 587                              â”‚
â”‚    - User: robotcomlab@gmail.com            â”‚
â”‚    - Pass: [encrypted]                      â”‚
â”‚                                             â”‚
â”‚ 2. Connect to SMTP server                   â”‚
â”‚ 3. Send email with attachment               â”‚
â”‚ 4. Receive confirmation                     â”‚
â”‚ 5. Log email sent:                          â”‚
â”‚    EmailLog {                               â”‚
â”‚      invoiceId: "inv-123",                  â”‚
â”‚      templateId: "tpl-payment",             â”‚
â”‚      recipientEmail: "john@example.com",    â”‚
â”‚      subject: "Payment Confirmation",       â”‚
â”‚      status: "sent",                        â”‚
â”‚      sentAt: now(),                         â”‚
â”‚      attachmentPath: "/archive/receipt.pdf" â”‚
â”‚    }                                        â”‚
â”‚ 6. Return result                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
     [Success!]
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend gets response:                â”‚
â”‚ IPC Message "email:sent" {             â”‚
â”‚   success: true,                       â”‚
â”‚   message: "Receipt sent to patient",  â”‚
â”‚   emailLogId: "log-xyz"                â”‚
â”‚ }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI Update:                     â”‚
â”‚ âœ“ Payment Recorded             â”‚
â”‚ âœ“ Confirmation Email Sent      â”‚
â”‚                                â”‚
â”‚ [Status: PAID]                 â”‚
â”‚ [Email sent to john@ex...]     â”‚
â”‚ [View Email Log]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MEANWHILE IN PATIENT'S INBOX:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ From: RobotCom Lab               â”‚
â”‚ To: John Doe                     â”‚
â”‚ Subject: Payment Confirmation    â”‚
â”‚                                  â”‚
â”‚ Dear John,                       â”‚
â”‚                                  â”‚
â”‚ Thank you for your payment!      â”‚
â”‚                                  â”‚
â”‚ Invoice: INV-2025-001234         â”‚
â”‚ Amount Paid: $150.00             â”‚
â”‚ Payment Date: Nov 19, 2025       â”‚
â”‚ Payment Method: Cash             â”‚
â”‚                                  â”‚
â”‚ [Receipt.pdf attached]           â”‚
â”‚                                  â”‚
â”‚ When your results are ready,     â”‚
â”‚ you'll receive them by email.    â”‚
â”‚                                  â”‚
â”‚ Questions? Contact us:           â”‚
â”‚ lab@robotcom.com                 â”‚
â”‚ +503-1234-5678                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## DATA FLOW: RESULTS â†’ EMAIL TO PATIENT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Results Review Screen              â”‚
â”‚ All tests complete and reviewed    â”‚
â”‚ Technician clicks:                 â”‚
â”‚ "Send Results to Patient"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ResultEmailWizard Component Opens          â”‚
â”‚                                            â”‚
â”‚ Step 1: Review Test Results                â”‚
â”‚ âœ“ Hemoglobin: 14.5 g/dL (Normal)          â”‚
â”‚ âœ“ MCV: 89.6 fL (Normal)                   â”‚
â”‚ âœ“ MCH: 30.2 pg (Normal)                   â”‚
â”‚ âœ“ Glucose: 125 mg/dL (Slightly High)      â”‚
â”‚ âš  Triglycerides: 280 mg/dL (High)         â”‚
â”‚                                            â”‚
â”‚ [Next] button                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Select Email Template       â”‚
â”‚                                     â”‚
â”‚ Template: "Test Results"            â”‚
â”‚ (Pre-filled)                        â”‚
â”‚                                     â”‚
â”‚ Options:                            â”‚
â”‚ â˜‘ Include PDF report               â”‚
â”‚ â˜‘ Include interpretation text      â”‚
â”‚ â˜‘ Include normal ranges            â”‚
â”‚ â˜‘ Include lab logo/branding        â”‚
â”‚                                     â”‚
â”‚ Preview: [Show Template]            â”‚
â”‚ [Next] button                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Select Recipients           â”‚
â”‚                                     â”‚
â”‚ Primary: john@example.com âœ“         â”‚
â”‚                                     â”‚
â”‚ Add more recipients:                â”‚
â”‚ â˜‘ Family member: mary@example.com  â”‚
â”‚ â˜‘ Physician: doc@clinic.com        â”‚
â”‚                                     â”‚
â”‚ [Next] button                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Review & Confirm            â”‚
â”‚                                     â”‚
â”‚ Recipients: 3                       â”‚
â”‚ Template: Test Results              â”‚
â”‚ Attachments:                        â”‚
â”‚ - report.pdf (detailed)             â”‚
â”‚                                     â”‚
â”‚ [Send] button                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–¼
      [User clicks Send]
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IPC Message: "results:sendEmail" {     â”‚
â”‚   sampleId: "sample-123",              â”‚
â”‚   recipientEmails: [                   â”‚
â”‚     "john@example.com",                â”‚
â”‚     "mary@example.com",                â”‚
â”‚     "doc@clinic.com"                   â”‚
â”‚   ],                                   â”‚
â”‚   templateCode: "RESULTS",             â”‚
â”‚   includeAttachments: true             â”‚
â”‚ }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EmailService.buildResultsEmail()               â”‚
â”‚                                                â”‚
â”‚ For each recipient:                            â”‚
â”‚                                                â”‚
â”‚ 1. Load template from DB:                      â”‚
â”‚    {                                           â”‚
â”‚      htmlTemplate: "...",                      â”‚
â”‚      variables: ["patientName",                â”‚
â”‚                  "testResults",                â”‚
â”‚                  "interpretations", ...]       â”‚
â”‚    }                                           â”‚
â”‚                                                â”‚
â”‚ 2. Gather data:                                â”‚
â”‚    - patientName: "John Doe"                   â”‚
â”‚    - allTests: [{                              â”‚
â”‚        name: "Hemoglobin",                     â”‚
â”‚        value: 14.5,                            â”‚
â”‚        unit: "g/dL",                           â”‚
â”‚        normalRange: "13.5-17.5",               â”‚
â”‚        status: "NORMAL",                       â”‚
â”‚        interpretation: "Result is normal"      â”‚
â”‚      }, ...]                                   â”‚
â”‚    - criticalValues: ["Triglycerides: HIGH"]   â”‚
â”‚    - recommendations: ["Follow-up lipid panel â”‚ â”‚
â”‚                         in 3 months"]          â”‚
â”‚                                                â”‚
â”‚ 3. Compile HTML template:                      â”‚
â”‚    Replace {{patientName}} â†’ "John Doe"        â”‚
â”‚    Replace {{testResults}} â†’ full table        â”‚
â”‚    Include conditional sections:               â”‚
â”‚      {{#if criticalValues}}                    â”‚
â”‚        <section>Critical Values...</section>   â”‚
â”‚      {{/if}}                                   â”‚
â”‚                                                â”‚
â”‚ 4. Generate PDF report:                        â”‚
â”‚    ReportService.generatePDF({                 â”‚
â”‚      sampleId: "sample-123",                   â”‚
â”‚      includeInterpretations: true,             â”‚
â”‚      includeLogo: true                         â”‚
â”‚    })                                          â”‚
â”‚    â†’ Creates professional PDF with:            â”‚
â”‚      - Lab header with logo                    â”‚
â”‚      - Patient demographics                    â”‚
â”‚      - All test results formatted              â”‚
â”‚      - Calculated values (MCV, etc.)           â”‚
â”‚      - Normal ranges highlighted               â”‚
â”‚      - Abnormal values in red                  â”‚
â”‚      - Interpretation text                     â”‚
â”‚      - Physician signature line                â”‚
â”‚      - Lab footer with contact info            â”‚
â”‚                                                â”‚
â”‚ 5. Result:                                     â”‚
â”‚    {                                           â”‚
â”‚      recipients: [                             â”‚
â”‚        {                                       â”‚
â”‚          email: "john@example.com",            â”‚
â”‚          htmlContent: "<html>...",             â”‚
â”‚          attachments: [{                       â”‚
â”‚            filename: "TestResults_20251119.pdf"â”‚
â”‚          }]                                    â”‚
â”‚        },                                      â”‚
â”‚        ... (for other recipients)              â”‚
â”‚      ]                                         â”‚
â”‚    }                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EmailService.sendBulkEmail()             â”‚
â”‚                                          â”‚
â”‚ For each recipient:                      â”‚
â”‚ 1. Send email via SMTP                   â”‚
â”‚ 2. Log in EmailLog table                 â”‚
â”‚ 3. Record sentAt timestamp               â”‚
â”‚ 4. Store attachmentPath                  â”‚
â”‚                                          â”‚
â”‚ 3 emails sent successfully               â”‚
â”‚ All logged for audit trail               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–¼
       [Success]
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Update Sample record:                  â”‚
â”‚ {                                      â”‚
â”‚   resultsEmailSent: true,              â”‚
â”‚   resultsEmailSentAt: "2025-11-19..." â”‚
â”‚   resultsEmailRecipients: [           â”‚
â”‚     "john@example.com",               â”‚
â”‚     "mary@example.com",               â”‚
â”‚     "doc@clinic.com"                  â”‚
â”‚   ]                                    â”‚
â”‚ }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend UI Update:                    â”‚
â”‚ âœ“ Emails sent to 3 recipients         â”‚
â”‚ âœ“ Timestamp: Nov 19, 2:45 PM          â”‚
â”‚ [View Email Log]                       â”‚
â”‚ [Resend Results]                       â”‚
â”‚                                        â”‚
â”‚ Status: RESULTS DELIVERED              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PATIENT'S INBOX:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ From: RobotCom Lab <lab@robotcom.com>   â”‚
â”‚ To: John Doe <john@example.com>         â”‚
â”‚ Subject: Your Test Results              â”‚
â”‚                                          â”‚
â”‚ Dear John,                               â”‚
â”‚                                          â”‚
â”‚ Your laboratory test results are ready! â”‚
â”‚                                          â”‚
â”‚ Test Results Summary:                    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                          â”‚
â”‚ TEST          VALUE    NORMAL      STATUS
â”‚ Hemoglobin    14.5     13.5-17.5    âœ“
â”‚ MCV           89.6     80-100       âœ“
â”‚ MCH           30.2     27-33        âœ“
â”‚ Glucose       125      70-100       âš 
â”‚ Triglycerides 280      <200         âš 
â”‚                                          â”‚
â”‚ Notes:                                   â”‚
â”‚ âš  Your triglycerides are elevated.      â”‚
â”‚   This is a risk factor for heart       â”‚
â”‚   disease. Recommend dietary changes    â”‚
â”‚   and possible medication. Follow-up    â”‚
â”‚   lipid panel in 3 months.              â”‚
â”‚                                          â”‚
â”‚ For detailed report, see attachment.    â”‚
â”‚                                          â”‚
â”‚ Questions? Contact us:                   â”‚
â”‚ RobotCom Laboratory                      â”‚
â”‚ lab@robotcom.com                         â”‚
â”‚ +503-1234-5678                           â”‚
â”‚ www.robotcomlab.com                      â”‚
â”‚                                          â”‚
â”‚ [Attachments: TestResults_20251119.pdf] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## COMPONENT INTERACTION MATRIX

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND â†” BACKEND INTERACTIONS                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚ COMPONENT              IPC MESSAGE          SERVICE               DB  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                        â”‚
â”‚ ChemistryTestForm      result:submit    â†’ CalculationEngine    â†’ DB  â”‚
â”‚                                         â†’ ResultInterpreter    â†’ DB  â”‚
â”‚                                                                        â”‚
â”‚ HematologyTestForm     result:submit    â†’ CalculationEngine    â†’ DB  â”‚
â”‚                                         â†’ (MCV, MCH, MCHC)     â†’ DB  â”‚
â”‚                                                                        â”‚
â”‚ InvoiceEntry           payment:record   â†’ PaymentService       â†’ DB  â”‚
â”‚                                         â†’ EmailService         â†’ DB  â”‚
â”‚                                                                        â”‚
â”‚ ResultReviewPanel      result:approve   â†’ ResultInterpreter    â†’ DB  â”‚
â”‚                                         â†’ ReflexTestingEngine  â†’ DB  â”‚
â”‚                                         â†’ DeltaCheckEngine     â†’ DB  â”‚
â”‚                                                                        â”‚
â”‚ EmailWizard            results:send     â†’ EmailService         â†’ DB  â”‚
â”‚                                         â†’ ReportService        â†’ PDF â”‚
â”‚                                                                        â”‚
â”‚ EmailHistoryViewer     email:fetch      â†’ EmailService         â†’ DB  â”‚
â”‚                        email:resend     â†’ EmailService         â†’ DB  â”‚
â”‚                                                                        â”‚
â”‚ ClinicalDashboard      data:fetch       â†’ AllServices (read)   â†’ DB  â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## TEST FORM FEATURES MATRIX

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TEST FORM FEATURES                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚ FEATURE                      ALL FORMS  SPECIAL FORMS                â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                       â”‚
â”‚ Auto-fill from previous       âœ“          -                           â”‚
â”‚ Unit selection                âœ“          -                           â”‚
â”‚ Real-time validation          âœ“          -                           â”‚
â”‚ Normal range display          âœ“          -                           â”‚
â”‚ Abnormality highlighting      âœ“          -                           â”‚
â”‚ Comments/notes field          âœ“          -                           â”‚
â”‚ Technician signature          âœ“          -                           â”‚
â”‚ Save & Continue               âœ“          -                           â”‚
â”‚                                                                       â”‚
â”‚ Auto-calculation (Hemo)       -          âœ“ Hematology               â”‚
â”‚   - MCV, MCH, MCHC                                                   â”‚
â”‚                                                                       â”‚
â”‚ Auto-calculation (Coag)       -          âœ“ Coagulation              â”‚
â”‚   - INR, PT Ratio, APPT                                             â”‚
â”‚                                                                       â”‚
â”‚ Differential entry (Hemo)     -          âœ“ Hematology               â”‚
â”‚   - WBC differential %                                               â”‚
â”‚                                                                       â”‚
â”‚ Titer calculation (Immuno)    -          âœ“ Immunology               â”‚
â”‚   - Last positive dilution                                           â”‚
â”‚                                                                       â”‚
â”‚ WHO classification (Sperm)    -          âœ“ Sperm Analysis           â”‚
â”‚   - Fertility status                                                 â”‚
â”‚   - Abnormalities list                                               â”‚
â”‚                                                                       â”‚
â”‚ Per-field averaging (Urine)   -          âœ“ Urinalysis               â”‚
â”‚   - Microscopy counts                                                â”‚
â”‚                                                                       â”‚
â”‚ Sensitivity table (Bacteria)  -          âœ“ Bacteriology             â”‚
â”‚   - AST results grid                                                 â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## EMAIL TEMPLATE TRIGGERS

```
EVENT                          TEMPLATE                    AUTO/MANUAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Payment recorded       â†’    Payment Confirmation       â†’    AUTO
Results completed      â†’    Test Results              â†’    MANUAL
Critical value found   â†’    Critical Alert            â†’    AUTO
Invoice created        â†’    Invoice/Bill              â†’    MANUAL
Reflex test ordered    â†’    Reflex Notification      â†’    AUTO
Appointment scheduled  â†’    Appointment Reminder      â†’    MANUAL (future)
```

---

## CALCULATION PRIORITY MATRIX

```
PRIORITY    CATEGORY        CALCULATIONS              IMPACT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â˜…â˜…â˜…â˜…â˜…      Hematology      MCV, MCH, MCHC, RDW      Frequently used
â˜…â˜…â˜…â˜…â˜…      Chemistry       LDL, Ratios, eGFR        Frequently used
â˜…â˜…â˜…â˜…â˜…      Coagulation     INR, PT Ratio, APPT      Life-critical
â˜…â˜…â˜…â˜…â˜†      Sperm           WHO Classification        Specialized
â˜…â˜…â˜…â˜†â˜†      Immunology      Titer calculations       Specialized
â˜…â˜…â˜…â˜†â˜†      Urinalysis      Per-field averaging      Detailed
â˜…â˜…â˜†â˜†â˜†      Bacteriology    Growth interpretation    Specialized
```

---

## EMAIL FEATURE COVERAGE

```
FEATURE                    CURRENT (FoxPro)    NEW (React App)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Email sending              âœ“ (CDO - OLD)       âœ“ (Modern SMTP)
Attachment support         âœ—                   âœ“
Template system            âœ—                   âœ“
Variable substitution      âœ—                   âœ“
HTML emails                âœ— (Basic)           âœ“ (Professional)
PDF generation             âœ—                   âœ“
Bulk sending               âœ—                   âœ“
Retry mechanism            âœ—                   âœ“
Delivery tracking          âœ—                   âœ“
Email logging              âœ—                   âœ“
Scheduled sends            âœ—                   âœ“
Auto-triggers              âœ— (Manual)          âœ“ (Automatic)
Compliance logging         âœ—                   âœ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
IMPROVEMENT SCORE                              300%+ features
```

---

This visual guide provides the complete picture of system architecture, data flows, and feature coverage needed for the implementation.
